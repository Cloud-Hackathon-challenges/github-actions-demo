version: "3.8"

services:
  mongodb:
    image: team1acrmanual9.azurecr.io/mongo:5
    restart: always

  # Seed şu an sende AVX/mongoimport yüzünden patlıyordu; şimdilik kapalı.
  # İstersen aşağıda "5) Elle seed" ile veriyi ekleyeceğiz.
  # mongo-seed:
  #   image: team1acrmanual9.azurecr.io/db-seed:webapp
  #   depends_on:
  #     - mongodb
  #   restart: "no"

  api:
    image: team1acrmanual9.azurecr.io/api:latest
    ports:
      - "4000:4000"
    environment:
      PORT: 4000
      MONGO_URI: mongodb://mongodb:27017/dobook
    depends_on:
      - mongodb

  frontend:
    image: team1acrmanual9.azurecr.io/frontend:latest
    ports:
      - "8080:80"        # rootless için 8080
    environment:
      API_HOST: api
      API_PORT: 4000     # <- DOĞRU HİZA (önceden yanlış düşüktü)
    depends_on:
      - api
